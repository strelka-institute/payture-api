<!-- Generated by documentation.js. Update this documentation by updating the source code. -->

### Table of Contents

-   [createPaytureApi][1]
    -   [Parameters][2]
    -   [Examples][3]
-   [init][4]
    -   [Parameters][5]
    -   [Examples][6]
-   [status][7]
    -   [Parameters][8]
    -   [Examples][9]
-   [getWidgetUrl][10]
    -   [Parameters][11]
    -   [Examples][12]
-   [widgetStatus][13]
    -   [Examples][14]
-   [serverNotification][15]
    -   [Parameters][16]
    -   [Examples][17]

## createPaytureApi

Create Payture InPay API.

**See [Payture InPay Docs][18]**

### Parameters

-   `options` **[object][19]?** 
    -   `options.host` **[string][20]** — Host of your payture account (optional, default `https://sandbox.payture.com`)
    -   `options.merchant` **[string][20]** — Your merchant account (optional, default `Merchant`)
    -   `options.returnUrl` **[string][20]?** — Url to return visitors after payment complete
    -   `options.chequeContactEmail` **[string][20]?** — Contact email for cheques
    -   `options.widgetHost` **[string][20]** — Payture widget template host (optional, default `https://merchantgateway.payture.com`)
    -   `options.widgetDomain` **[string][20]** — [Widget domain][21] (use `1` for production) (optional, default `2`)

### Examples

```javascript
const createPaytureApi = require('@strelka/payture-api')

const api = createPaytureApi({
  host: 'https://sandbox.payture.com',
  merchant: 'Merchant',
  returnUrl: 'http://example.com?orderid={orderid}&result={success}',
  chequeContactEmail: 'billing@example.com',
  widgetDomain: 1
})

// api.init(data)
// api.status(OrderId)
// api.pay(SessionId)
// api.getWidgetUrl(data)
// api.widgetStatus()
// api.serverNotification(res.body)
```

Returns **api** 

## init

Start [Payture InPay][22] session.

### Parameters

-   `data` **[object][19]?**  (optional, default `{}`)
    -   `data.OrderId` **([string][20] \| [number][23])?** — Unique order id
    -   `data.Amount` **([string][20] \| [number][23])?** — Total price in kopeck (`1000` is `10.00₽`)
    -   `data.Product` **[string][20]?** — Product name (visible to user)
    -   `data.Description` **[string][20]?** — Order description
    -   `data.Language` **[string][20]?** — Order page language `EN` or `RU`
    -   `data.Cheque` **[object][19]?** — [Cheque][24] to send (optional)
        -   `data.Cheque.Message` **[number][23]?** — Order description
        -   `data.Cheque.Positions` **[Array][25]&lt;[object][19]>?** — Order Items
            -   `data.Cheque.Positions.Quantity` **[number][23]?** — Quantity
            -   `data.Cheque.Positions.Price` **[number][23]?** — Price in kopeck
            -   `data.Cheque.Positions.Tax` **[number][23]?** — [Tax system][26] code for item
            -   `data.Cheque.Positions.Text` **[string][20]?** — Item description
        -   `data.Cheque.CheckClose` **[string][20]?** 
            -   `data.Cheque.CheckClose.TaxationSystem` **[number][23]?** — [Tax system][26] code for order

### Examples

```javascript
api.init({
  OrderId: OrderId,
  Amount: 50000,
  Product: 'ticket',
  Description: 'MyTestTransaction',
  Language: 'EN'
})
.then(({ SessionId, PaymentUrl }) => {
  // Somehow send PaymentUrl to user
})
.catch((error) => {
  // ErrorCode in error.message
})
```

Returns **[Promise][27]&lt;[object][19]>** — with `{ OrderId, Amount, SessionId, PaymentUrl }`

Returns **[Promise][27]&lt;[Error][28]>** — with [Payture `ErrorCode`][29] in message

## status

Check order status.

### Parameters

-   `OrderId` **[string][20]?** — Used in [init][4] order

### Examples

```javascript
api.status('WqNl4LDHnv5250Ng8zaTQ')
 .then((res) => {
   if (res.isPaid) {
     // Do something
   }
 })
 .catch((error) => {
   // Payment is ended with error
 })
```

Returns **[object][19]** `result`

Returns **[boolean][30]** `result.isPaid` — Parsed order payment status

Returns **[object][19]** `result.raw` — Raw result from Payture

Returns **[Promise][27]&lt;[Error][28]>** — with [Payture `ErrorCode`][29] in message

## getWidgetUrl

Create order widget url. Url is used in `<iframe>` `src`.

### Parameters

-   `order` **[object][19]?** — See order description in [init][4]. (optional, default `{}`)
    -   `order.Domain`   (optional, default `opts.widgetDomain`)
    -   `order.Key`   (optional, default `opts.merchant`)
    -   `order.Amount`  
    -   `order.Product`  
    -   `order.Cheque`  
    -   `order.Session`  
    -   `order.rest` **...any** 

### Examples

```javascript
const widgetSrc = api.getWidgetUrl({
  Amount: 50000,
  Product: 'ticket',
  Description: 'MyTestTransaction',
  Language: 'EN',
  Cheque: {
    Positions: [
      {
        Quantity: 1.000,
        Price: 50000,
        Tax: 6,
        Text: 'Test Good'
      }
    ],
    CheckClose: { TaxationSystem: 6 },
    Message: 'Test Cheque Message'
  }
})
```

```javascript
<iframe src={widgetSrc} frameBorder={0} onLoad={handleWidgetLoad} />
```

Returns **[string][20]** — Url to widget page

## widgetStatus

Watch for [widget order status][31].
Works in browser. Resolves promise if payment is succesful and rejects on error.

### Examples

```javascript
<iframe src={widgetSrc} frameBorder={0} onLoad={handleWidgetLoad} />
```

```javascript
widgetStatus()
 .then((event) => {
   // Success: event.data === 'CLOSE_PAYTURE_WIDGET_SUCCESS'
 })
 .catch((event) => {
   // Error: : event.data === 'CLOSE_PAYTURE_WIDGET_ERROR'
 })
```

Returns **[Promise][27]** `status`

Returns **[function][32]** `status.cancel` — cancel promise and stop event listener

## serverNotification

Check [Payture Server Notification][33].
Resolves promise with data on success and rejects [Payture `ErrorCode`][29] on error.

### Parameters

-   `data` **[object][19]?** Parsed server POST body (optional, default `{}`)

### Examples

```javascript
const express = require('express')
const bodyParser = require('body-parser')
const paytureApi = require('@strelka/payture-api')()

app.use('/payture/notification', bodyParser.urlencoded(), (req, res) => {
  paytureApi.serverNotification(req.body)
   .then((data) => {
     // Payment successful
   })
   .catch((error) => {
     // Something wrong happend
   })
})
```

Returns **[Promise][27]** 

[1]: #createpaytureapi

[2]: #parameters

[3]: #examples

[4]: #init

[5]: #parameters-1

[6]: #examples-1

[7]: #status

[8]: #parameters-2

[9]: #examples-2

[10]: #getwidgeturl

[11]: #parameters-3

[12]: #examples-3

[13]: #widgetstatus

[14]: #examples-4

[15]: #servernotification

[16]: #parameters-4

[17]: #examples-5

[18]: https://payture.com/api#inpay_

[19]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Object

[20]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/String

[21]: https://payture.com/api#widget-docs_widget-params_

[22]: https://payture.com/api#inpay_init_

[23]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Number

[24]: https://payture.com/api#kassy-fz54_cheque-format-with-payment_

[25]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Array

[26]: https://payture.com/api#kassy-fz54_cheque-status_

[27]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise

[28]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Error

[29]: https://payture.com/api#error-codes_

[30]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Boolean

[31]: https://payture.com/api#widget-docs_workflow_

[32]: https://developer.mozilla.org/docs/Web/JavaScript/Reference/Statements/function

[33]: https://payture.com/api#notifications_
